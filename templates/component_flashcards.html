<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Componente – Tarjetas de vocabulario</title>
  <style>
    :root{
      --accent:#e45700ff; /* corporativo */
      --ink:#434343;      /* títulos */
      --muted:#666666;    /* párrafos */
      --bar-bg:#eeeeee;   /* fondo de barra */
      --good:#10b981;
      --again:#ef4444;
      --card:#ffffff;
    }
    *{box-sizing:border-box}
    body{ margin:0; background:#fff; }

    /* ---- Contenedor requerido ---- */
    .comp-wrap{
      width:90%;
      height:500px;
      margin:16px auto;
      border:1px solid #e9e9e9;
      border-radius:12px;
      overflow:hidden;
      display:grid;
      grid-template-rows: auto 1fr 8px;
      grid-template-areas: "head" "content" "prog";
      background:#fff;
      box-shadow: 0 4px 18px rgba(0,0,0,.06);
    }

    header{
      grid-area:head;
      padding:16px 20px 0 20px;
    }
    h1{
      margin:0 0 6px;
      font:700 26px Arial, Helvetica, sans-serif;
      color:var(--ink);
    }
    .subtitle{
      font:700 14px Arial, Helvetica, sans-serif;
      color:var(--accent);
      margin-top:2px;
    }
    p.intro{
      margin:6px 0 10px;
      font:400 12px "Proxima Nova","ProximaNova",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--muted);
      line-height:1.6;
    }

    .content{
      grid-area:content;
      height:100%;
      padding:10px 18px 16px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
    }

    /* Card area */
    .stage{
      display:grid; place-items:center;
      position:relative; overflow:hidden;
    }
    .card{
      width:min(520px, 100%);
      height:min(280px, 70%);
      perspective:1000px;
      position:relative;
    }
    .card .face{
      position:absolute; inset:0;
      background:var(--card);
      border:1px solid #e6e8eb; border-radius:14px;
      box-shadow:0 8px 26px rgba(0,0,0,.08);
      display:flex; align-items:center; justify-content:center;
      padding:18px;
      backface-visibility:hidden;
      transition: transform .5s ease, box-shadow .2s ease;
      font:600 22px Arial, Helvetica, sans-serif;
      color:var(--ink);
      text-align:center;
    }
    .card .back{
      transform: rotateY(180deg);
      font:400 16px "Proxima Nova","ProximaNova",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--muted);
      line-height:1.6;
    }
    .card.flip .front{ transform:rotateY(180deg); }
    .card.flip .back{ transform:rotateY(360deg); }

    .tap-hint{
      position:absolute; bottom:-2px; left:50%; transform:translateX(-50%);
      font:700 12px Arial, Helvetica, sans-serif; color:#97a1ab;
    }

    .actions{
      margin-top:12px; display:flex; gap:12px; justify-content:center;
    }
    .btn{
      border:0; border-radius:24px; padding:10px 16px;
      font:700 14px Arial, Helvetica, sans-serif; cursor:pointer; color:#fff;
      box-shadow:0 3px 10px rgba(0,0,0,.15);
    }
    .btn.good{ background:var(--good); }
    .btn.again{ background:var(--again); }
    .btn.flip{ background:var(--accent); }

    /* Sidebar stats */
    .side{
      border-left:1px solid #ececec;
      padding:8px 12px;
      display:flex; flex-direction:column; gap:10px;
    }
    .stat{
      padding:12px 12px;
      border:1px solid #ececec; border-radius:10px; background:#fafbfc;
    }
    .stat h3{
      margin:0 0 6px; font:700 16px Arial, Helvetica, sans-serif; color:var(--ink);
    }
    .stat p{
      margin:0; color:var(--muted);
      font:400 12px "Proxima Nova","ProximaNova",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    }
    .list{
      flex:1 1 auto; overflow:auto; border:1px dashed #e0e3e7; border-radius:10px; padding:8px;
    }
    .chip{
      display:inline-block; margin:4px; padding:6px 8px; border-radius:12px;
      background:#eef2f7; color:#4b5563; font:700 12px Arial, Helvetica, sans-serif;
    }

    /* Animations */
    .anim-correct{ animation: pop .35s ease; }
    .anim-again{ animation: shake .35s ease; }
    @keyframes pop{ 0%{transform:scale(1);} 60%{transform:scale(1.06);} 100%{transform:scale(1);} }
    @keyframes shake{
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-4px); }
      40%, 60% { transform: translateX(4px); }
    }

    /* Progress bar */
    .progress{ grid-area:prog; height:8px; background:var(--bar-bg); position:relative; }
    .progress .bar{ position:absolute; inset:0 auto 0 0; width:0%; background:var(--accent); transition:width .25s ease; }

    /* Responsive */
    @media (max-width: 860px){
      .content{ grid-template-columns: 1fr; }
      .side{ border-left:0; border-top:1px solid #ececec; }
      .card{ height:220px; }
    }
  </style>
</head>
<body>
  <!-- Cambia el id para identificar este HTML en tu orquestador -->
  <section class="comp-wrap" data-component-id="flash-001">
    <header>
      <h1>Tarjetas de vocabulario</h1>
      <div class="subtitle">Toca para voltear. Marca “Lo sé” o “Repasar”.</div>
      <p class="intro">Juego de tarjetas educativas para aprender vocabulario con animaciones y seguimiento del progreso.</p>
    </header>

    <div class="content">
      <div class="stage">
        <div class="card" id="card" aria-live="polite" tabindex="0">
          <div class="face front" id="front">apple</div>
          <div class="face back" id="back">manzana</div>
        </div>
        <div class="tap-hint">Click o barra espaciadora para voltear</div>
        <div class="actions">
          <button class="btn flip" id="flip">Voltear</button>
          <button class="btn again" id="again">Repasar</button>
          <button class="btn good" id="good">Lo sé</button>
        </div>
      </div>

      <aside class="side">
        <div class="stat">
          <h3>Progreso</h3>
          <p><strong id="mastered">0</strong> dominadas de <strong id="total">0</strong> (<span id="pct">0</span>%)</p>
        </div>
        <div class="stat">
          <h3>Siguientes en cola</h3>
          <div class="list" id="queue"></div>
        </div>
      </aside>
    </div>

    <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
  </section>

  <script>
    (function(){
      const wrap = document.querySelector('.comp-wrap');
      const id = wrap.getAttribute('data-component-id') || 'flashcards-component';

      // ======= DECK por defecto (edítalo) =======
      let deck = [
        { term:'apple', def:'manzana' },
        { term:'book', def:'libro' },
        { term:'house', def:'casa' },
        { term:'teacher', def:'profesor/a' },
        { term:'window', def:'ventana' }
      ];

      // Estado
      let index = 0;                   // índice en la cola actual
      let mastered = new Set();        // ids dominados
      let queue = deck.map((d,i)=> i); // cola de índices
      let flipped = false;

      // UI refs
      const card = document.getElementById('card');
      const front = document.getElementById('front');
      const back = document.getElementById('back');
      const flipBtn = document.getElementById('flip');
      const goodBtn = document.getElementById('good');
      const againBtn = document.getElementById('again');
      const qDiv = document.getElementById('queue');
      const masteredEl = document.getElementById('mastered');
      const totalEl = document.getElementById('total');
      const pctEl = document.getElementById('pct');
      const bar = document.getElementById('bar');

      function post(pct){
        try{
          window.parent && window.parent.postMessage({
            type:'componentProgress',
            componentId:id,
            progress:pct,
            completed: pct >= 95,
            stats: { mastered: mastered.size, total: deck.length }
          }, '*');
        }catch(e){}
      }

      function render(){
        if(queue.length === 0){
          front.textContent = '¡Completado!';
          back.textContent = 'Has dominado todas las tarjetas.';
          card.classList.add('flip'); // mostrar mensaje final en el reverso
          flipBtn.disabled = true; againBtn.disabled = true; goodBtn.disabled = true;
          updateStats();
          return;
        }
        const cur = deck[queue[index]];
        front.textContent = cur.term;
        back.textContent = cur.def;
        card.classList.toggle('flip', flipped);
        // queue preview
        qDiv.innerHTML = queue.slice(index, index+6).map(i=> '<span class="chip">'+deck[i].term+'</span>').join('');
        updateStats();
      }

      function updateStats(){
        const pct = Math.round((mastered.size / deck.length) * 100);
        masteredEl.textContent = mastered.size;
        totalEl.textContent = deck.length;
        pctEl.textContent = pct;
        bar.style.width = pct + '%';
        post(pct);
      }

      function flip(){ flipped = !flipped; card.classList.toggle('flip', flipped); }

      function nextCard(animClass){
        // animación pequeña
        card.classList.add(animClass);
        setTimeout(()=> card.classList.remove(animClass), 380);

        flipped = false;
        // avanzar en cola
        index = (index + 1) % queue.length;
        render();
      }

      goodBtn.addEventListener('click', ()=>{
        const curId = queue[index];
        mastered.add(curId);
        // sacar la tarjeta de la cola
        queue.splice(index, 1);
        if(queue.length === 0){ render(); return; }
        if(index >= queue.length) index = 0;
        nextCard('anim-correct');
      });

      againBtn.addEventListener('click', ()=>{
        const curId = queue[index];
        // enviar al final de la cola si quedan más
        if(queue.length > 1){
          queue.push(curId);
          queue.splice(index, 1);
          if(index >= queue.length) index = 0;
        }
        nextCard('anim-again');
      });

      flipBtn.addEventListener('click', flip);
      card.addEventListener('click', flip);
      card.addEventListener('keydown', (e)=>{ if(e.key===' ' || e.key==='Enter'){ e.preventDefault(); flip(); } });

      // API pública para el orquestador
      window.Flashcards = {
        setDeck(arr){ // arr: [{term, def}]
          if(!Array.isArray(arr) || !arr.length) return;
          deck = arr;
          index = 0;
          mastered = new Set();
          queue = deck.map((_,i)=> i);
          flipped = false;
          render();
        },
        shuffle(){
          for(let i=queue.length-1;i>0;i--){
            const j=Math.floor(Math.random()*(i+1)); [queue[i],queue[j]]=[queue[j],queue[i]];
          }
          index = 0; render();
        }
      };

      // Inicial
      render();
    })();
  </script>
</body>
</html>
