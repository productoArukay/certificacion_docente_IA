<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Componente – Narrativo</title>
  <style>
    :root{
      --accent:#e45700ff;
      --ink:#434343;      /* Títulos */
      --muted:#666666;    /* Párrafos */
      --teal:#007d88;     /* Tarjeta narrativa de referencia (puedes cambiarla si quieres) */
      --bar-bg:#eeeeee;
    }
    *{box-sizing:border-box}
    body{ margin:0; background:#fff; }

    /* ---- Contenedor requerido ---- */
    .comp-wrap{
      width:90%;
      height:500px;
      margin:16px auto;
      border:1px solid #e9e9e9;
      border-radius:12px;
      overflow:hidden;
      display:grid;
      grid-template-rows: auto 1fr 8px;
      grid-template-areas:
        "head"
        "content"
        "prog";
      background:#fff;
      box-shadow: 0 4px 18px rgba(0,0,0,.06);
    }

    header{
      grid-area:head;
      padding:16px 20px 0 20px;
    }
    h1{
      margin:0 0 6px;
      font:700 26px Arial, Helvetica, sans-serif;
      color:var(--ink);
    }
    p.intro{
      margin:0 0 10px;
      font:400 12px "Proxima Nova","ProximaNova",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--muted);
      line-height:1.6;
    }
    p.callout{
      margin:8px 0 14px;
      font:700 14px Arial, Helvetica, sans-serif;
      color:var(--accent);
    }

    .content{
      grid-area:content;
      padding:0 18px 16px;
      height:100%;
    }

    .stage{
      display:grid;
      grid-template-columns: 1.2fr .9fr;
      gap:22px;
      height:100%;
      align-items:stretch;
    }

    /* CARRUSEL (izquierda) */
    .carousel{
      position:relative;
      background:#c5c7cc;
      border:1px solid #e1e1e1;
      border-radius:6px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:260px;
    }
    .slide{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      transition:opacity .25s ease;
    }
    .slide.active{ opacity:1; }
    .slide img, .slide iframe, .slide video{
      width:100%; height:100%; object-fit:cover; border:0;
    }
    .nav-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:48px; height:56px;
      background:var(--accent);
      border-radius:4px;
      border:none;
      color:#fff;
      font:700 20px Arial, Helvetica, sans-serif;
      cursor:pointer;
      opacity:.95;
    }
    .nav-btn.prev{ left:10px; }
    .nav-btn.next{ right:10px; }
    .dots{
      position:absolute; bottom:10px; left:0; right:0;
      display:flex; gap:8px; justify-content:center;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background:#cfd3d8; border:0; cursor:pointer;
    }
    .dot.active{ background:var(--accent); }

    /* PANEL NARRATIVO (derecha) */
    .panel{
      background:var(--teal);
      color:#fff;
      border-radius:6px;
      padding:18px 18px;
      overflow:auto;
    }
    .panel h2{
      margin:0 0 8px;
      font:700 18px Arial, Helvetica, sans-serif;
      letter-spacing:.2px;
    }
    .panel p{
      margin:0 0 10px;
      font:400 12px "Proxima Nova","ProximaNova",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      line-height:1.6;
    }

    /* Barra de progreso */
    .progress{ grid-area:prog; height:8px; background:var(--bar-bg); position:relative; }
    .progress .bar{ position:absolute; inset:0 auto 0 0; width:0%; background:var(--accent); transition:width .25s ease; }

    /* Responsive */
    @media (max-width: 900px){
      .stage{ grid-template-columns:1fr; }
      .panel{ min-height:160px; }
    }
  </style>
</head>
<body>
  <!-- Cambia el id para identificar este HTML en tu orquestador -->
  <section class="comp-wrap" data-component-id="narr-001">
    <header>
      <h1>Narrativo</h1>
      <p class="intro">El componente narrativo permite desplazarse por una serie de imágenes, cada una acompañada de texto.</p>
      <p class="intro">Este componente siempre está distribuido.</p>
      <p class="callout">Seleccione las flechas siguiente y atrás para obtener más información.</p>
    </header>

    <div class="content">
      <div class="stage">
        <!-- Carrusel a la izquierda -->
        <div class="carousel" id="carousel" aria-live="polite">
          <div class="slide active">
            <div style="color:#fff; font:600 14px Arial; opacity:.9;">Slide 1 (reemplaza por imagen/iframe)</div>
          </div>
          <div class="slide">
            <div style="color:#fff; font:600 14px Arial; opacity:.9;">Slide 2</div>
          </div>
          <div class="slide">
            <div style="color:#fff; font:600 14px Arial; opacity:.9;">Slide 3</div>
          </div>

          <button class="nav-btn prev" aria-label="Anterior">&#10094;</button>
          <button class="nav-btn next" aria-label="Siguiente">&#10095;</button>

          <div class="dots" id="dots" aria-hidden="true">
            <button class="dot active" data-i="0"></button>
            <button class="dot" data-i="1"></button>
            <button class="dot" data-i="2"></button>
          </div>
        </div>

        <!-- Panel narrativo a la derecha -->
        <aside class="panel" id="panel">
          <h2>Elemento narrativo 1</h2>
          <p>Las narrativas son adecuadas para mostrar diálogos entre dos o más personajes, con cada paso de la conversación acompañado de una imagen.</p>
          <p>Este enfoque puede usarse para contextualizar el aprendizaje, ilustrar su aplicación en el mundo real o mostrar el impacto en las personas.</p>
        </aside>
      </div>
    </div>

    <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
  </section>

  <script>
    (function(){
      const wrap = document.querySelector('.comp-wrap');
      const id = wrap.getAttribute('data-component-id') || 'narrative-component';
      const carousel = document.getElementById('carousel');
      const slides = Array.from(carousel.querySelectorAll('.slide'));
      const dots = Array.from(document.querySelectorAll('.dot'));
      const prev = carousel.querySelector('.prev');
      const next = carousel.querySelector('.next');
      const bar  = document.getElementById('bar');
      const panel = document.getElementById('panel');

      const captions = [
        {title:'Elemento narrativo 1', body:[
          'Las narrativas son adecuadas para mostrar diálogos y secuencias.',
          'Usa cada paso para avanzar la historia con una imagen.']},
        {title:'Elemento narrativo 2', body:[
          'Puedes usar fotos, ilustraciones o iframes de mini apps.',
          'Mantén los textos breves para favorecer el ritmo.']},
        {title:'Elemento narrativo 3', body:[
          'Cierra con una reflexión o una pregunta.',
          'Esto ayuda a consolidar el aprendizaje.']},
      ];

      let i = 0;

      function render(){
        slides.forEach((s,idx)=> s.classList.toggle('active', idx===i));
        dots.forEach((d,idx)=> d.classList.toggle('active', idx===i));

        // Actualizar panel de texto
        const data = captions[i] || {title:'', body:[]};
        panel.innerHTML = '<h2>'+data.title+'</h2>' +
          data.body.map(p=>'<p>'+p+'</p>').join('');

        // Progreso por índice de slide
        const pct = Math.round(((i+1)/slides.length)*100);
        bar.style.width = pct + '%';
        post(pct);
      }

      function post(pct){
        try{
          window.parent && window.parent.postMessage({
            type:'componentProgress',
            componentId:id,
            progress:pct,
            completed: pct >= 95
          }, '*');
        }catch(e){/* no-op */}
      }

      prev.addEventListener('click', ()=>{ i = (i-1+slides.length)%slides.length; render(); });
      next.addEventListener('click', ()=>{ i = (i+1)%slides.length; render(); });
      dots.forEach(d=> d.addEventListener('click', ()=>{ i = parseInt(d.dataset.i,10)||0; render(); }));

      // Inicial
      render();
    })();
  </script>
</body>
</html>
